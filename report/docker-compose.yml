version: '3.8'

services:
  # Основной пайплайн (использует существующий файл синонимов)
  brand-normalizer:
    build: .
    image: brand-normalizer:latest
    container_name: brand-normalizer
    environment:
      - TOGETHER_API_KEY=${TOGETHER_API_KEY}
    volumes:
      - ./data:/app/data:ro
      - ./output:/app/output
      - ./synonyms:/app/synonyms
    command: ["--skip-synonyms"]

  # Генерация синонимов (отдельная команда)
  generate-synonyms:
    build: .
    environment:
      - TOGETHER_API_KEY=${TOGETHER_API_KEY}
    volumes:
      - ./data:/app/data:ro
      - ./synonyms:/app/synonyms
    command: ["--step", "1"]
